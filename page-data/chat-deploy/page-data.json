{"componentChunkName":"component---src-templates-blog-post-js","path":"/chat-deploy/","result":{"data":{"site":{"siteMetadata":{"title":"공자윤의 기술블로그"}},"markdownRemark":{"id":"502344f4-1226-574d-943c-f9cceb304a2e","excerpt":"기존 앱은 하나의 next app…","html":"<p>기존 앱은 하나의 next app에서 라우팅으로 오글톡 서비스와 래키바위보 서비스를 나누어 놓은 구조였습니다.</p>\n<p>프로젝트 내부에서 컴포넌트가 세분화되어 있긴 했지만 이러한 구조에서는 빌드 및 배포 또한 한번에 할 수밖에 없었기 때문에, 오글톡의 수정 사항이 생길 때마다 래키바위보에도 영향을 받게 되어 분리가 필요하다고 판단했습니다.</p>\n<p>마침 작년 즈음부터 마이크로 프론트엔드 아키텍처를 적용해 보고 싶다는 생각을 하던 차에, 좋은 기회라 생각되어 모노레포 방식을 적용해 보기로 결심하였습니다.</p>\n<h2>모노레포란?</h2>\n<p>“A monorepo is a single repository containing muliple distinct projects, with well defined relationships.”\n“모노레포란 잘 정의된 관계를 가진, 여러 개의 독립적인 프로젝트들이 있는 하나의 repository이다.”</p>\n<h3>모노레포의 장점</h3>\n<ul>\n<li>새 프로젝트의 생성 비용이 적다.</li>\n<li>프로젝트 간 코드 공유가 쉽다.</li>\n<li>소스 분리가 편리하다.</li>\n<li>하나의 커밋으로 repository를 관리할 수 있다.</li>\n<li>히스토리 관리가 쉽다.</li>\n<li>일관적인 개발자 경험을 제공한다.</li>\n<li>빌드 및 배포 시 각각의 프로젝트에 영향을 미치지 않는다.</li>\n</ul>\n<p>이러한 장점들만으로도 아키텍처 변경을 시도할 만한 이유는 충분하였습니다.</p>\n<p>모노레포를 적용하는 방식 및 지원하는 도구는 다양했는데, 우리 회사의 on-premise 환경에서 지원하는 pnpm과 현재 프로젝트에서 사용 중인 next, typescript 등 여러 가지 사항을 고려했을 때 turborepo를 사용하는 것이 가장 적합하다고 판단하였습니다. 그리고 옆 팀에서 개발 중인 디자인 시스템에서도 turborepo를 채택했기 때문에, on-premise 환경에 배포를 실패할 리스크가 확 줄어든다는 점에서 부담이 줄어든 이유도 있었습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3b5020c00693aecc09428fa4bebbcdfb/f36fd/chat_4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.37974683544304%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+0lEQVR42m1R2Y6DMAzk/3+Ml2ofKAipkOXYcAVQOUI4xaxsbSt1hSUriTKesceW4zjwfR9d16FpGozjCK01n5TTNKFtW7iuC8/z8Hw+L3GUfd/DIkLbthGGIZRSuIphGFiUcUKgKIpL3HmesIIgwI+UiKIIWZZh2zas64o0TZHnOQOpqziO4Xsevm43JEnCGMJSjcwyFFKirWtY30LAaI3FGNRK4TgOVlqWBfM8fxC69zuPLqVkHKUxhu2atOY7d0iPvuveHf0PKhBCgMSDxwNRHGPfdyYsy5ItYFIipFErpd4fr0WQ4fpPtaoqtqBtGp6iKMsP3GtB5PUvDEjFO9wr8AEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"chat_4\"\n        title=\"\"\n        src=\"/static/3b5020c00693aecc09428fa4bebbcdfb/f058b/chat_4.png\"\n        srcset=\"/static/3b5020c00693aecc09428fa4bebbcdfb/c26ae/chat_4.png 158w,\n/static/3b5020c00693aecc09428fa4bebbcdfb/6bdcf/chat_4.png 315w,\n/static/3b5020c00693aecc09428fa4bebbcdfb/f058b/chat_4.png 630w,\n/static/3b5020c00693aecc09428fa4bebbcdfb/40601/chat_4.png 945w,\n/static/3b5020c00693aecc09428fa4bebbcdfb/78612/chat_4.png 1260w,\n/static/3b5020c00693aecc09428fa4bebbcdfb/f36fd/chat_4.png 2488w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>기존 구조에서는 오글톡과 래키바위보 서비스를 하나의 서버(포트)에 띄웠으며, 기능 중 일부를 수정해 배포하면 서비스 전체가 새로 배포되는 과정을 거칩니다.</p>\n<p>오른쪽 그림의 마이크로 프론트엔드 구조에서는 오글톡, 래키바위보 프로젝트를 각각의 서비스로 분리하여 서버(포트)를 별도로 띄우기 때문에 일부 코드만 수정해서 별도로 배포가 가능합니다.</p>\n<h2>프로젝트 구조</h2>\n<p>저는 turborepo에서 제공하는 bolierplate로 프로젝트를 생성하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">npx create-turbo</code></pre></div>\n<p>이렇게 하면 다음과 같은 구조로 프로젝트가 생성됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">├──packages <span class=\"token punctuation\">(</span>공유 파일<span class=\"token punctuation\">)</span>\n\t└── ui\n├──apps <span class=\"token punctuation\">(</span>서비스<span class=\"token punctuation\">)</span>\n\t├── docs\n\t└── web</code></pre></div>\n<p>저는 채팅플랫폼 성격에 맞게 다음과 같이 구조를 변경하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">├──packages <span class=\"token punctuation\">(</span>공유 파일<span class=\"token punctuation\">)</span>\n\t├── shared <span class=\"token punctuation\">(</span>공통 비즈니스 로직<span class=\"token punctuation\">)</span>\n\t\t└── types\n\t\t└── enum\n\t\t└── hooks\n\t\t└── api\n\t\t└── utils\n\t└── ui <span class=\"token punctuation\">(</span>공통 ui 컴포넌트<span class=\"token punctuation\">)</span>\n\t\t└── atom\n\t\t└── molecule\n\t\t└── template\n\t\t└── popup\n\t\t└── toast\n├──apps <span class=\"token punctuation\">(</span>서비스<span class=\"token punctuation\">)</span>\n\t├── ogog <span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span>\n\t├── rps <span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span>\n\t└── <span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">(</span>확장 가능<span class=\"token punctuation\">)</span></code></pre></div>\n<p><a href=\"https://jayoon-kong.github.io/chat-develop\">개발 포스팅</a>에서 언급한 것과 같이 각 프로젝트에서 가져다 쓸 수 있는 공통 비즈니스 로직과 공통 ui 컴포넌트를 분리하여 <code class=\"language-text\">packages</code> 내부에 포함시켰습니다.</p>\n<p>이제 이 컴포넌트를 각 프로젝트에서 어떻게 import할 수 있는지 알아보겠습니다.</p>\n<h2>의존성 설정</h2>\n<p><code class=\"language-text\">apps</code> 폴더 내부에 있는 각 <code class=\"language-text\">app</code>의 <code class=\"language-text\">package.json</code>을 살펴보면, <code class=\"language-text\">dependencies</code> 항목에 다음과 같이 정의가 되어 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token string-property property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"@repo/shared\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"workspace:*\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"@repo/ui\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"workspace:*\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>여기서 <code class=\"language-text\">@repo/shared</code>, <code class=\"language-text\">@repo/ui</code>는 <code class=\"language-text\">packages</code> 내부에 있는 <code class=\"language-text\">shared</code>와 <code class=\"language-text\">ui</code>에서 정의된 이름입니다. 그리고 <code class=\"language-text\">workspace:*</code>의 의미는 pnpm에서 제공하는 기능으로, 같은 작업 공간 내에서 의존성을 관리할 때 사용됩니다. 즉 해당 패키지가 작업 공간 내에서 사용 가능한 모든 버전을 허용한다는 의미입니다.</p>\n<p>따라서 이 코드는 현재 작업공간에 있는 <code class=\"language-text\">@repo/shared</code>와 <code class=\"language-text\">@repo/ui</code> 패키지를 의존성으로 추가하겠다는 의미입니다.</p>\n<p>다음으로는 <code class=\"language-text\">app</code>의 <code class=\"language-text\">next.config.mjs</code>에서 특정 패키지에 있는 코드를 변환(ES6)할 수 있도록 설정해 줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">transpilePackages: <span class=\"token punctuation\">[</span><span class=\"token string\">\"@repo/ui\"</span>, <span class=\"token string\">\"@repo/shared\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>마지막으로 <code class=\"language-text\">app</code>의 <code class=\"language-text\">tsconfig.json</code>에서 해당 이름으로 import를 해올 수 있도록 추가해 줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token string\">\"paths\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"@/*\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./*\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 <code class=\"language-text\">app</code>의 컴포넌트에서 <code class=\"language-text\">packages</code>의 컴포넌트를 불러올 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> useLog <span class=\"token keyword\">from</span> <span class=\"token string\">\"@repo/shared/src/hooks/useLog\"</span></code></pre></div>\n<h2>빌드 설정</h2>\n<p>오글톡과 래키바위보를 분리하여 빌드하고 배포하기 위해서, <code class=\"language-text\">root</code>에 있는 <code class=\"language-text\">package.json</code>에 따로 설정을 추가하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token string-property property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"dev:ogog\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"turbo dev --filter ogog\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"dev:rps\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"turbo dev --filter rps\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"start:ogog\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"turbo start --filter ogog\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"start:rps\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"turbo start --filter rps\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"build:ogog\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"turbo build --filter ogog\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"build:rps\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"turbo build --filter rps\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 하면 원하는 프로젝트별로 따로 실행 및 빌드가 가능합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">pnpm</span> dev:ogog</code></pre></div>\n<p>젠킨스에서 기존에 사용하던 빌드 설정을 프로젝트 갯수만큼 분리하여, 기존의 <code class=\"language-text\">npm run start</code> 대신 <code class=\"language-text\">pnpm run start:ogog</code>과 같은 형태로 바꿔 주기만 하면 빌드 설정은 끝납니다. 생각보다 아주 간단합니다.</p>\n<h2>배포 설정</h2>\n<p>같은 도메인에서 각 프로젝트를 어떻게 띄울까에 대한 고민을 하다가, ChatGPT의 조언에 따라 프로젝트별로 port를 따로 설정하여 기존 URL로 redirect하는 방식을 사용하기로 결정하였습니다.</p>\n<p>즉, 기존에는 하나의 next 프로젝트에서 라우팅 기반으로 ogog과 rps가 나눠져 있었기 때문에 <a href=\"https://%EB%8F%84%EB%A9%94%EC%9D%B8/ogog\">https://도메인/ogog</a>, <a href=\"https://%EB%8F%84%EB%A9%94%EC%9D%B8/rps\">https://도메인/rps</a> 이런 식으로 URL이 자연스럽게 구성되었는데요, 이제는 next 프로젝트가 별도로 나눠졌기 때문에 기존 방식으로는 URL을 사용할 수 없었습니다.</p>\n<p>이에 각 프로젝트별로 3001, 3002번 포트를 따로 설정하여 실행되도록 하고, nginx에서 각 포트와 서비스명을 매핑시켜 리다이렉트하는 구조로 설정하였습니다.</p>\n<p>우선 각 프로젝트의 <code class=\"language-text\">package.json</code> 파일에서 script 설정을 해 줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ogog > package.json</span>\n<span class=\"token string-property property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"NEXT_PUBLIC_MODE=DEV next dev --turbo --port 3001\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token comment\">// rps > package.json</span>\n<span class=\"token string-property property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"NEXT_PUBLIC_MODE=DEV next dev --turbo --port 3002\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음으로는 nginx에서 redirect를 위한 설정을 해 줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">upstream frontend_ogog <span class=\"token punctuation\">{</span>\n    server localhost:3001 <span class=\"token assign-left variable\">max_fails</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token assign-left variable\">fail_timeout</span><span class=\"token operator\">=</span>15s<span class=\"token punctuation\">;</span>\n    keepalive <span class=\"token number\">20000</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nupstream frontend_rps <span class=\"token punctuation\">{</span>\n    server localhost:3002 <span class=\"token assign-left variable\">max_fails</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token assign-left variable\">fail_timeout</span><span class=\"token operator\">=</span>15s<span class=\"token punctuation\">;</span>\n    keepalive <span class=\"token number\">20000</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">location /ogog <span class=\"token punctuation\">{</span>\n    proxy_pass http://frontend_ogog<span class=\"token punctuation\">;</span>\n    proxy_set_header Host <span class=\"token variable\">$host</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Real-IP <span class=\"token variable\">$remote_addr</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Forwarded-For <span class=\"token variable\">$proxy_add_x_forwarded_for</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Forwarded-Proto <span class=\"token variable\">$scheme</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nlocation /rps <span class=\"token punctuation\">{</span>\n    proxy_pass http://frontend_rps<span class=\"token punctuation\">;</span>\n    proxy_set_header Host <span class=\"token variable\">$host</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Real-IP <span class=\"token variable\">$remote_addr</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Forwarded-For <span class=\"token variable\">$proxy_add_x_forwarded_for</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Forwarded-Proto <span class=\"token variable\">$scheme</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 설정하고 기존 도메인으로 접속하면, ogog 또는 rps로 들어왔을 때 설정해 둔 각 포트(3001, 3002)로 실행이 되면서 각 서비스가 정상적으로 작동하는 것을 확인할 수 있었습니다.</p>\n<h2>이슈</h2>\n<h3>이슈 1. pathname</h3>\n<p>기존에는 hook에서 사용하는 공통 로직이 next 프로젝트 내부에 있었기 때문에, <code class=\"language-text\">next/navigation</code>에서 제공하는 <code class=\"language-text\">usePathname</code>을 통해 편리하게 path 이름을 가져오고 있었는데요.</p>\n<p>이제 <code class=\"language-text\">packages</code>로 빠진 컴포넌트에서는 <code class=\"language-text\">usePathname</code>을 사용하지 못해, 기존 <code class=\"language-text\">window</code>에서 제공하는 <code class=\"language-text\">location</code>의 <code class=\"language-text\">pathname</code>을 사용하도록 변경하였습니다.</p>\n<h3>이슈 2. CORS 오류</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">개발서버에서는 서버 설정으로 CORS를 따로 허용해 줘야 하는데요, 이번에 nginx에 location을 따로 추가하였기 때문에 해당 설정도 추가로 허용해 줘야 합니다.\n\nlocation /ogog <span class=\"token punctuation\">{</span>\n    add_header <span class=\"token string\">'Access-Control-Allow-Origin'</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$request_method</span> <span class=\"token operator\">=</span> <span class=\"token string\">'OPTIONS'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        add_header <span class=\"token string\">'Access-Control-Allow-Methods'</span> <span class=\"token string\">'GET, POST, DELETE, PATCH, OPTIONS'</span><span class=\"token punctuation\">;</span>\n        add_header <span class=\"token string\">'Access-Control-Allow-Headers'</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">;</span>\n        add_header <span class=\"token string\">'Access-Control-Allow-Credentials'</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token builtin class-name\">return</span> <span class=\"token number\">204</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    proxy_pass http://frontend_ogog<span class=\"token punctuation\">;</span>\n    proxy_set_header Host <span class=\"token variable\">$host</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Real-IP <span class=\"token variable\">$remote_addr</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Forwarded-For <span class=\"token variable\">$proxy_add_x_forwarded_for</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Forwarded-Proto <span class=\"token variable\">$scheme</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nlocation /rps <span class=\"token punctuation\">{</span>\n    add_header <span class=\"token string\">'Access-Control-Allow-Origin'</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$request_method</span> <span class=\"token operator\">=</span> <span class=\"token string\">'OPTIONS'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        add_header <span class=\"token string\">'Access-Control-Allow-Methods'</span> <span class=\"token string\">'GET, POST, DELETE, PATCH, OPTIONS'</span><span class=\"token punctuation\">;</span>\n        add_header <span class=\"token string\">'Access-Control-Allow-Headers'</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">;</span>\n        add_header <span class=\"token string\">'Access-Control-Allow-Credentials'</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token builtin class-name\">return</span> <span class=\"token number\">204</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    proxy_pass http://frontend_rps<span class=\"token punctuation\">;</span>\n    proxy_set_header Host <span class=\"token variable\">$host</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Real-IP <span class=\"token variable\">$remote_addr</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Forwarded-For <span class=\"token variable\">$proxy_add_x_forwarded_for</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Forwarded-Proto <span class=\"token variable\">$scheme</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 하니 모든 설정이 잘 된 것을 확인할 수 있었습니다.</p>\n<h2>마무리</h2>\n<p>소스를 마이그레이션하는 과정에서 사소한 삽질도 많았고, 환경 설정을 할 때 초반에 잘 되지 않아서 시간을 많이 소모하기도 했지만 이렇게 성공하고 나니 매우 뿌듯했습니다. 무엇보다도 <strong>각 프로젝트의 빌드 및 배포 시 다른 프로젝트에 영향을 미치지 않는다는 점</strong>이 큰 성과였습니다.</p>\n<p>플랫폼을 더 플랫폼답게 만드는 작은 한 걸음이 되었다고 생각합니다.</p>\n<p>앞으로 편리하게 다른 프로젝트를 확장할 수 있고, 또 기존에 사용하던 공통 컴포넌트의 히스토리/버전 관리 및 새로운 기술 적용 등을 용이하게 할 수 있다는 점에서 의미가 있는 작업이었던 것 같습니다.</p>","frontmatter":{"title":"채팅플랫폼 구현 과정 - 배포 (모노레포 전환)","date":"October 29, 2024","description":"채팅플랫폼 구현 과정 - 배포 (모노레포 전환)","author":"jayoon"}},"previous":{"fields":{"slug":"/chat-develop/"},"frontmatter":{"title":"채팅플랫폼 구현 과정 - 개발"}},"next":null},"pageContext":{"id":"502344f4-1226-574d-943c-f9cceb304a2e","previousPostId":"901246f4-23da-5920-9351-2b2be98d6164","nextPostId":null}},"staticQueryHashes":["2841359383"],"slicesMap":{}}
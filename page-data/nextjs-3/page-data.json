{"componentChunkName":"component---src-templates-blog-post-js","path":"/nextjs-3/","result":{"data":{"site":{"siteMetadata":{"title":"ê³µììœ¤ì˜ ê¸°ìˆ ë¸”ë¡œê·¸"}},"markdownRemark":{"id":"34b278df-356c-57e4-98c7-ec93fa6afc32","excerpt":"ë³¸ í¬ìŠ¤íŒ…ì—ì„œëŠ” ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼ ê°ì ë‹¤ë¥¸ í˜ì´ì§€ë¥¼ ë¦¬í„´í•˜ê³ , ì„¸ì…˜ì„ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì‘ì„±í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. í˜„ì¬ V ì»¬ëŸ¬ë§ì—ì„œëŠ” JWTâ€¦","html":"<p>ë³¸ í¬ìŠ¤íŒ…ì—ì„œëŠ” ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼ ê°ì ë‹¤ë¥¸ í˜ì´ì§€ë¥¼ ë¦¬í„´í•˜ê³ , ì„¸ì…˜ì„ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì‘ì„±í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>\n<p>í˜„ì¬ V ì»¬ëŸ¬ë§ì—ì„œëŠ” <strong>JWT</strong> ë°©ì‹ì„ ì´ìš©í•˜ì—¬ ì„¸ì…˜ ê´€ë¦¬ë¥¼ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ íœ´ëŒ€í° ë²ˆí˜¸ë‚˜ ì†Œì…œ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ì„ í•˜ë©´ ì„œë²„ì—ì„œëŠ” ê±°ê¸°ì— ë§ëŠ” <code class=\"language-text\">access_token</code>ì„ <code class=\"language-text\">refresh_token</code>ê³¼ í•¨ê»˜ ë°œê¸‰í•˜ê³ , API í˜¸ì¶œ ì‹œ headerì— <code class=\"language-text\">access_token</code>ì„ ì‹¤ì–´ ë³´ë‚´ì„œ ì¸ì¦ì„ í•˜ê³  ë§Œë£Œê°€ ë˜ë©´ <code class=\"language-text\">refresh_token</code>ìœ¼ë¡œ ë‹¤ì‹œ ê°±ì‹ ì„ í•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.</p>\n<p>ì¼ë°˜ì ìœ¼ë¡œ ë³´ì•ˆì´ ìš°ìˆ˜í•˜ë‹¤ê³  ì•Œë ¤ì§„ ë°©ì‹ì€ <code class=\"language-text\">access_token</code>ì€ ë°›ì•„ì„œ ë°”ë¡œ headerì˜ default ê°’ìœ¼ë¡œ ì„¸íŒ…í•˜ê³ , <code class=\"language-text\">refresh_token</code>ì€ cookieì˜ <code class=\"language-text\">httpOnly</code> ì†ì„±ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>\n<p>ê¸°ì¡´ì˜ V ì»¬ëŸ¬ë§ì€ ê·¸ëƒ¥ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— í† í°ì„ ì €ì¥í•˜ì—¬ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë°, ì´ë²ˆì— next.jsë¥¼ ë„ì…í•˜ë©´ì„œ ì„¸ì…˜ì„ ì„œë²„ ì‚¬ì´ë“œ ë° í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ëª¨ë‘ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë³€ê²½í•´ ë³´ëŠ” ê²ƒì´ ì¢‹ê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. íŠ¹íˆ my ì˜ì—­ì˜ ê²½ìš° APPì—ì„œë„ ì›¹ë·° í˜•íƒœë¡œ ì œê³µë˜ê³  ìˆê¸° ë•Œë¬¸ì— ì´ˆê¸° ë¡œë”© ì†ë„ê°€ ëŠë ¤ì„œ, ì„œë²„ì‚¬ì´ë“œì—ì„œ ì„¸ì…˜ ìœ ë¬´ë¥¼ íŒë‹¨í•œ í›„ ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼, ë¡œê·¸ì¸í•œ ì‚¬ìš©ìëŠ” ë§ˆì´í˜ì´ì§€ë¥¼ ë°”ë¡œ ë„ì›Œ ì£¼ê¸°ë¡œ ê²°ì •í•œ ì ì´ ê°€ì¥ í° ì´ìœ ì…ë‹ˆë‹¤.</p>\n<p>ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ì„ ê²€ìƒ‰í•´ ë³´ê³  ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ ì°¾ì•„ë³¸ ëì—, ê²°êµ­ ì–‘ìª½ì—ì„œ ììœ ë¡­ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í† í°ì„ ì¿ í‚¤ì— ì €ì¥í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¢‹ê² ë‹¤ëŠ” ê²°ë¡ ì„ ë‚´ë ¸ìŠµë‹ˆë‹¤. httpOnly ì†ì„±ì„ ì„œë²„ì—ì„œ ë¦¬í„´í•´ ì£¼ë©´ ì¢‹ê² ì§€ë§Œ í˜„ì¬ êµ¬ì¡°ì ìœ¼ë¡œ ê·¸ë ‡ê²Œ ì„¤ê³„ë˜ì–´ ìˆì§€ ì•Šê³ , ë˜ SSRì—ì„œëŠ” ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì ‘ê·¼í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì–‘ìª½ì—ì„œ ëª¨ë‘ ì“¸ ìˆ˜ ìˆëŠ” ì¿ í‚¤ë¡œ ì„ íƒí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>\n<p>SSRê³¼ CSR ëª¨ë‘ì—ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•œ <code class=\"language-text\">js-cookie</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•˜ê³  ë¨¼ì € ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ë¡œê·¸ì¸ì„ í•˜ëŠ” ë¡œì§ì„ êµ¬í˜„í•œ ë’¤, ë¡œê·¸ì¸ ì„±ê³µ í›„ í† í°ì„ ì¿ í‚¤ì— ì €ì¥í•˜ëŠ” ë¶€ë¶„ì„ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// set token</span>\n<span class=\"token keyword\">import</span> Cookies <span class=\"token keyword\">from</span> <span class=\"token string\">\"js-cookie\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setToken</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  Cookies<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"token\"</span><span class=\"token punctuation\">,</span> token<span class=\"token punctuation\">.</span>token<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">expires</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  Cookies<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"refreshToken\"</span><span class=\"token punctuation\">,</span> token<span class=\"token punctuation\">.</span>refreshToken<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">expires</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  Cookies<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"expired\"</span><span class=\"token punctuation\">,</span> token<span class=\"token punctuation\">.</span>expired<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">expires</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//login</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setUserInfoAfterLogin</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  router<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/my\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">login</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">username</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">authKey</span><span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> AuthApi<span class=\"token punctuation\">.</span><span class=\"token function\">getToken</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> authKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">res</span><span class=\"token operator\">:</span> any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>access_token<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setUserInfoAfterLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ë‹¤ìŒì€ my.tsxì—ì„œ ì„¸ì…˜ ìœ ë¬´ë¥¼ ì²´í¬í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token literal-property property\">getServerSideProps</span><span class=\"token operator\">:</span> <span class=\"token function-variable function\">GetServerSideProps</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> req <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// ì¿ í‚¤ì—ì„œ í† í° ì •ë³´ë¥¼ ì¶”ì¶œí•œ ë’¤ headerì˜ Authorizationì— ì¶”ê°€í•´ ì¤ë‹ˆë‹¤.</span>\n  <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>cookies<span class=\"token punctuation\">.</span>token\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>token <span class=\"token operator\">!==</span> <span class=\"token string\">\"undefined\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    axios<span class=\"token punctuation\">.</span>defaults<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span><span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Bearer </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>token<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> userInfo <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">fetchQuery</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">[</span>QueryKey<span class=\"token punctuation\">.</span><span class=\"token constant\">GET_USER_INFO</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    UserApi<span class=\"token punctuation\">.</span>getUserInfo<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">staleTime</span><span class=\"token operator\">:</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">cacheTime</span><span class=\"token operator\">:</span> <span class=\"token number\">Infinity</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>userInfo<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">redirect</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">destination</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/login?my\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">permanent</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> dehydrateState <span class=\"token operator\">=</span> <span class=\"token function\">dehydrate</span><span class=\"token punctuation\">(</span>queryClient<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      dehydrateState<span class=\"token punctuation\">,</span>\n      userInfo<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>ì´ìŠˆ</h3>\n<p>ì´ë ‡ê²Œ êµ¬í˜„í–ˆë”ë‹ˆ ìƒˆë¡œê³ ì¹¨ ì‹œì—ëŠ” ë§ˆì´í˜ì´ì§€ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ëŠ”ë°, ë¡œê·¸ì¸ ë° í† í°ì„ ì…‹íŒ…í•œ ì§í›„ì—ëŠ” ê·¸ëŒ€ë¡œ ë¡œê·¸ì¸ í˜ì´ì§€ì— ë¨¸ë¬¼ëŸ¬ ìˆëŠ” ì´ìŠˆê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë¡œê·¸ë¥¼ ì°ì–´ ë³´ë‹ˆ ì¸ì¦ ì˜¤ë¥˜ ì´ìŠˆì˜€ìŠµë‹ˆë‹¤.</p>\n<p>ì°¸ê³ ë¡œ ì˜¤ë¥˜ê°€ ë‚¬ì„ ë•Œì˜ axios instanceì˜ interceptor ì½”ë“œì…ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ìš”ì²­ ì¸í„°ì…‰í„°</span>\ninstance<span class=\"token punctuation\">.</span>interceptors<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\">config</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ìš”ì²­ ì „ì— ìˆ˜í–‰í•  ì‘ì—…</span>\n    <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> Token<span class=\"token punctuation\">.</span><span class=\"token function\">getToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Cookies.get('token')</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      config<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span>Authorization <span class=\"token operator\">=</span> token\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> config\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ìš”ì²­ ì˜¤ë¥˜ ì²˜ë¦¬</span>\n    <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>axiosì˜ interceptorsì—ì„œëŠ” í† í° ê°’ì„ ê°€ì ¸ì™”ë‹¤ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆë‹¤ í•˜ëŠ” ì´ìŠˆê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ë¥¼ ë³´ë©° í˜„ìƒì„ íŒŒì•…í•´ ë³´ë‹ˆ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ í˜¸ì¶œí–ˆì„ ë•Œì—ë§Œ Cookies.get(â€™tokenâ€™)ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ë°œê²¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>\n<p>ê·¸ë˜ì„œ ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getToken</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> auth <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span>defaults<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span>Authorization <span class=\"token comment\">// ë””í´íŠ¸ í—¤ë” ê°’ì„ ë¨¼ì € ê°€ì ¸ì˜´</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>auth <span class=\"token operator\">&amp;&amp;</span> auth <span class=\"token operator\">!==</span> <span class=\"token string\">\"undefined\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> auth\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> Token<span class=\"token punctuation\">.</span><span class=\"token function\">getToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// ì—†ëŠ” ê²½ìš°ì— ì¿ í‚¤ì—ì„œ ì§ì ‘ ê°€ì ¸ì˜´</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>token <span class=\"token operator\">&amp;&amp;</span> token <span class=\"token operator\">!==</span> <span class=\"token string\">\"undefined\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Bearer </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>token<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ìš”ì²­ ì¸í„°ì…‰í„°</span>\ninstance<span class=\"token punctuation\">.</span>interceptors<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\">config</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ìš”ì²­ ì „ì— ìˆ˜í–‰í•  ì‘ì—…</span>\n    <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> <span class=\"token function\">getToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>token <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>config<span class=\"token punctuation\">.</span>url<span class=\"token operator\">?.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"oauth\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      config<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span>Authorization <span class=\"token operator\">=</span> token\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> config\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ìš”ì²­ ì˜¤ë¥˜ ì²˜ë¦¬</span>\n    <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>ì„œë²„ì‚¬ì´ë“œì—ì„œ <code class=\"language-text\">req.cookies.token</code> ìœ¼ë¡œ ê°€ì ¸ì˜¨ ê°’ì„ ë””í´íŠ¸ í—¤ë”ì— ë„£ì—ˆê¸° ë•Œë¬¸ì— SSRì¸ ê²½ìš° í—¤ë” ê°’ì´ ìˆìœ¼ë¯€ë¡œ ê·¸ ê°’ì„ ì‚¬ìš©í•˜ê³ , ì—†ëŠ” ê²½ìš°ëŠ” CSRì´ë¯€ë¡œ ì¿ í‚¤ì— ì ‘ê·¼í•˜ì—¬ í† í°ì„ ê°€ì ¸ì˜¤ë„ë¡ ì²˜ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n<p>ì´ë ‡ê²Œ í–ˆë”ë‹ˆ ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ì„¸ì…˜ì´ ì—†ëŠ” ê²½ìš°ì—ëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ê°€, ì„¸ì…˜ì´ ìˆëŠ” ê²½ìš°ì—ëŠ” ë§ˆì´ í˜ì´ì§€ê°€ ë¦¬í„´ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ë¡œê·¸ì•„ì›ƒ í›„ ë¡œê·¸ì¸ ì‹œì—ë„ ìì—°ìŠ¤ëŸ½ê²Œ í™”ë©´ì´ ì „í™˜ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>\n<p>(ì‹¤ì œ í™˜ê²½ì—ì„œë„ ì˜ ì‘ë™í•˜ëŠ”ì§€ ì¢€ë” í…ŒìŠ¤íŠ¸í•´ë³¸ í›„ í™•ì‹¤íˆ ë„ì…í•  ì˜ˆì •ì…ë‹ˆë‹¤.)</p>\n<p>ê°€ì¥ ì‚½ì§ˆì„ ë§ì´ í–ˆì§€ë§Œ ë§ì´ ë°°ìš¸ ìˆ˜ ìˆì—ˆë˜ ê²½í—˜ì´ì—ˆìŠµë‹ˆë‹¤. ğŸ˜Š</p>","frontmatter":{"title":"V ì»¬ëŸ¬ë§ì— Next.js ë„ì…í•˜ê¸° (3)","date":"March 23, 2023","description":"Reactë¡œ êµ¬í˜„ëœ SPA (CSR) í”„ë¡œì íŠ¸ë¥¼ Next.jsë¡œ Migrationí•˜ëŠ” ê³¼ì •","author":"jayoon"}},"previous":{"fields":{"slug":"/nextjs-2/"},"frontmatter":{"title":"V ì»¬ëŸ¬ë§ì— Next.js ë„ì…í•˜ê¸° (2)"}},"next":null},"pageContext":{"id":"34b278df-356c-57e4-98c7-ec93fa6afc32","previousPostId":"63da2233-25d4-5d3e-816d-6262e7bce4a8","nextPostId":null}},"staticQueryHashes":["2841359383"],"slicesMap":{}}
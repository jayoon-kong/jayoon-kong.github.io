{"componentChunkName":"component---src-templates-blog-post-js","path":"/nextjs-authentication/","result":{"data":{"site":{"siteMetadata":{"title":"ê³µììœ¤ì˜ ê¸°ìˆ ë¸”ë¡œê·¸"}},"markdownRemark":{"id":"747b18b7-ff8b-5239-a05a-3ed52dbf0e82","excerpt":"ë³¸ í¬ìŠ¤íŒ…ì—ì„œëŠ” ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼ ê°ì ë‹¤ë¥¸ í˜ì´ì§€ë¥¼ ë¦¬í„´í•˜ê³ , ì„¸ì…˜ì„ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì‘ì„±í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. í˜„ì¬ V ì»¬ëŸ¬ë§ì—ì„œëŠ” JWTâ€¦","html":"<p>ë³¸ í¬ìŠ¤íŒ…ì—ì„œëŠ” ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼ ê°ì ë‹¤ë¥¸ í˜ì´ì§€ë¥¼ ë¦¬í„´í•˜ê³ , ì„¸ì…˜ì„ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì‘ì„±í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>\n<p>í˜„ì¬ V ì»¬ëŸ¬ë§ì—ì„œëŠ” <strong>JWT</strong> ë°©ì‹ì„ ì´ìš©í•˜ì—¬ ì„¸ì…˜ ê´€ë¦¬ë¥¼ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ íœ´ëŒ€í° ë²ˆí˜¸ë‚˜ ì†Œì…œ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ì„ í•˜ë©´ ì„œë²„ì—ì„œëŠ” ê±°ê¸°ì— ë§ëŠ” <code class=\"language-text\">access_token</code>ì„ <code class=\"language-text\">refresh_token</code>ê³¼ í•¨ê»˜ ë°œê¸‰í•˜ê³ , API í˜¸ì¶œ ì‹œ headerì— <code class=\"language-text\">access_token</code>ì„ ì‹¤ì–´ ë³´ë‚´ì„œ ì¸ì¦ì„ í•˜ê³  ë§Œë£Œê°€ ë˜ë©´ <code class=\"language-text\">refresh_token</code>ìœ¼ë¡œ ë‹¤ì‹œ ê°±ì‹ ì„ í•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.</p>\n<p>ì¼ë°˜ì ìœ¼ë¡œ ë³´ì•ˆì´ ìš°ìˆ˜í•˜ë‹¤ê³  ì•Œë ¤ì§„ ë°©ì‹ì€ <code class=\"language-text\">access_token</code>ì€ ë°›ì•„ì„œ ë°”ë¡œ headerì˜ default ê°’ìœ¼ë¡œ ì„¸íŒ…í•˜ê³ , <code class=\"language-text\">refresh_token</code>ì€ cookieì˜ <code class=\"language-text\">httpOnly</code> ì†ì„±ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>\n<p>ê¸°ì¡´ì˜ V ì»¬ëŸ¬ë§ì€ ê·¸ëƒ¥ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— í† í°ì„ ì €ì¥í•˜ì—¬ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë°, ì´ë²ˆì— next.jsë¥¼ ë„ì…í•˜ë©´ì„œ ì„¸ì…˜ì„ ì„œë²„ ì‚¬ì´ë“œ ë° í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ëª¨ë‘ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë³€ê²½í•´ ë³´ëŠ” ê²ƒì´ ì¢‹ê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. íŠ¹íˆ my ì˜ì—­ì˜ ê²½ìš° APPì—ì„œë„ ì›¹ë·° í˜•íƒœë¡œ ì œê³µë˜ê³  ìˆê¸° ë•Œë¬¸ì— ì´ˆê¸° ë¡œë”© ì†ë„ê°€ ëŠë ¤ì„œ, ì„œë²„ì‚¬ì´ë“œì—ì„œ ì„¸ì…˜ ìœ ë¬´ë¥¼ íŒë‹¨í•œ í›„ ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼, ë¡œê·¸ì¸í•œ ì‚¬ìš©ìëŠ” ë§ˆì´í˜ì´ì§€ë¥¼ ë°”ë¡œ ë„ì›Œ ì£¼ê¸°ë¡œ ê²°ì •í•œ ì ì´ ê°€ì¥ í° ì´ìœ ì…ë‹ˆë‹¤.</p>\n<p>ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ì„ ê²€ìƒ‰í•´ ë³´ê³  ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ ì°¾ì•„ë³¸ ëì—, ê²°êµ­ ì–‘ìª½ì—ì„œ ììœ ë¡­ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í† í°ì„ ì¿ í‚¤ì— ì €ì¥í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¢‹ê² ë‹¤ëŠ” ê²°ë¡ ì„ ë‚´ë ¸ìŠµë‹ˆë‹¤. httpOnly ì†ì„±ì„ ì„œë²„ì—ì„œ ë¦¬í„´í•´ ì£¼ë©´ ì¢‹ê² ì§€ë§Œ í˜„ì¬ êµ¬ì¡°ì ìœ¼ë¡œ ê·¸ë ‡ê²Œ ì„¤ê³„ë˜ì–´ ìˆì§€ ì•Šê³ , ë˜ SSRì—ì„œëŠ” ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì ‘ê·¼í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì–‘ìª½ì—ì„œ ëª¨ë‘ ì“¸ ìˆ˜ ìˆëŠ” ì¿ í‚¤ë¡œ ì„ íƒí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>\n<p>ë¨¼ì € <code class=\"language-text\">react-cookie</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•˜ê³  ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ë¡œê·¸ì¸ì„ í•˜ëŠ” ë¡œì§ì„ êµ¬í˜„í•œ ë’¤, ë¡œê·¸ì¸ ì„±ê³µ í›„ í† í°ì„ ì¿ í‚¤ì— ì €ì¥í•˜ëŠ” ë¶€ë¶„ì„ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ë¡œê·¸ì¸ ì„±ê³µ ì´í›„ ì²˜ë¦¬</span>\nTokenHelper<span class=\"token punctuation\">.</span><span class=\"token function\">setToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">token</span><span class=\"token operator\">:</span> token<span class=\"token punctuation\">.</span>access_token<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">refreshToken</span><span class=\"token operator\">:</span> token<span class=\"token punctuation\">.</span>refresh_token<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">expired</span><span class=\"token operator\">:</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> token<span class=\"token punctuation\">.</span>expires_in <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// TokenHelper</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Cookies <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-cookie'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> cookie <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Cookies</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token function\">setToken</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">params</span><span class=\"token operator\">:</span> VRAuth<span class=\"token punctuation\">.</span>IToken</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> token<span class=\"token punctuation\">,</span> refreshToken<span class=\"token punctuation\">,</span> expired <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> params<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cookie<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">,</span> token<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">expires</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>expired<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cookie<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'refreshToken'</span><span class=\"token punctuation\">,</span> refreshToken<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">expires</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>expired <span class=\"token operator\">*</span> <span class=\"token number\">60</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cookie<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'expired'</span><span class=\"token punctuation\">,</span> expired<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">expires</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>expired<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ë¡œê·¸ì¸ì€ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì—, ì„œë²„ ì‚¬ì´ë“œì—ì„œ <code class=\"language-text\">getInitialProps</code>ìœ¼ë¡œ ì ‘ê·¼í–ˆì„ ë•Œ ì¿ í‚¤ê°€ ë‚ ì•„ê°€ì§€ ì•Šë„ë¡ ì„œë²„ ì‚¬ì´ë“œì—ì„œë„ ì„¸íŒ…ì„ í•´ ì¤ë‹ˆë‹¤.\në¨¼ì € <code class=\"language-text\">CookiesProvider</code>ë¡œ appì„ ê°ì‹¸ê³ , ì„œë²„ì˜ ì¿ í‚¤ë¥¼ ì‰½ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ <code class=\"language-text\">next-cookies</code>ë¥¼ ì¶”ê°€ë¡œ ì„¤ì¹˜í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CookiesProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-cookie'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> cookies <span class=\"token keyword\">from</span> <span class=\"token string\">'next-cookies'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>CookiesProvider<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Layout<span class=\"token operator\">></span>\n        <span class=\"token operator\">...</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Layout<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>CookiesProvider<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nApp<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">getInitialProps</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> pageProps<span class=\"token punctuation\">,</span> ctx <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">initializeToken</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      Component<span class=\"token punctuation\">,</span>\n      pageProps<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">initializeToken</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">ctx</span><span class=\"token operator\">:</span> any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">req</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> headers <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> any <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> token<span class=\"token punctuation\">,</span> refreshToken<span class=\"token punctuation\">,</span> expired <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">cookies</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>token <span class=\"token operator\">&amp;&amp;</span> refreshToken <span class=\"token operator\">&amp;&amp;</span> expired<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    TokenHelper<span class=\"token punctuation\">.</span><span class=\"token function\">setToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> token<span class=\"token punctuation\">,</span> refreshToken<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">expired</span><span class=\"token operator\">:</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>expired<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ìë™ ê°±ì‹ </span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>expired<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">updateToken</span><span class=\"token punctuation\">(</span>refreshToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> access_token<span class=\"token punctuation\">,</span> refresh_token<span class=\"token punctuation\">,</span> expires_in <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> response<span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>access_token<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        TokenHelper<span class=\"token punctuation\">.</span><span class=\"token function\">setToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">token</span><span class=\"token operator\">:</span> access_token<span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">refreshToken</span><span class=\"token operator\">:</span> refresh_token<span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">expired</span><span class=\"token operator\">:</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> expires_in <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  TokenHelper<span class=\"token punctuation\">.</span><span class=\"token function\">clearToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ë‹¤ìŒì€ <code class=\"language-text\">my.tsx</code>ì—ì„œ ì„¸ì…˜ ìœ ë¬´ë¥¼ ì²´í¬í•˜ì—¬ ì„¸ì…˜ì´ ì—†ëŠ” ê²½ìš° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬ë¥¼ í•©ë‹ˆë‹¤.\n<code class=\"language-text\">login.tsx</code>ì—ì„œë„ ë§ˆì°¬ê°€ì§€ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// my.tsx</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token literal-property property\">getServerSideProps</span><span class=\"token operator\">:</span> <span class=\"token function-variable function\">GetServerSideProps</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> tokenData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">initializeToken</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> query <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> param <span class=\"token operator\">=</span> <span class=\"token function\">searchParams</span><span class=\"token punctuation\">(</span>query <span class=\"token keyword\">as</span> IParameters<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>tokenData <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>tokenData<span class=\"token operator\">?.</span>token <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>tokenData<span class=\"token operator\">?.</span>expired<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>EnvChecker<span class=\"token punctuation\">.</span><span class=\"token function\">isApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">redirect</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">destination</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/login?my</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>param <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&amp;</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>param<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">permanent</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">memo</span><span class=\"token punctuation\">(</span>My<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// login.tsx</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token literal-property property\">getServerSideProps</span><span class=\"token operator\">:</span> <span class=\"token function-variable function\">GetServerSideProps</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> query <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> param <span class=\"token operator\">=</span> <span class=\"token function\">searchParams</span><span class=\"token punctuation\">(</span>query <span class=\"token keyword\">as</span> IParameters<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> tokenData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">initializeToken</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tokenData <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>tokenData<span class=\"token operator\">?.</span>expired<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">redirect</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">destination</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>param<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">permanent</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ì´ë ‡ê²Œ í–ˆë”ë‹ˆ ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ì„¸ì…˜ì´ ì—†ëŠ” ê²½ìš°ì—ëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ê°€, ì„¸ì…˜ì´ ìˆëŠ” ê²½ìš°ì—ëŠ” ë§ˆì´ í˜ì´ì§€ê°€ ë¦¬í„´ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ë¡œê·¸ì•„ì›ƒ í›„ ë¡œê·¸ì¸ ì‹œì—ë„ ìì—°ìŠ¤ëŸ½ê²Œ í™”ë©´ì´ ì „í™˜ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>\n<p>ê°€ì¥ ì‚½ì§ˆì„ ë§ì´ í–ˆì§€ë§Œ ë§ì´ ë°°ìš¸ ìˆ˜ ìˆì—ˆë˜ ê²½í—˜ì´ì—ˆìŠµë‹ˆë‹¤. ğŸ˜Š</p>","frontmatter":{"title":"Next.js ì „í™˜ ê³¼ì • - ì¸ì¦ ë° í† í° ì²˜ë¦¬í•˜ê¸°","date":"May 26, 2023","description":"Reactë¡œ êµ¬í˜„ëœ SPA (CSR) í”„ë¡œì íŠ¸ë¥¼ Next.jsë¡œ ì „í™˜í•˜ëŠ” ê³¼ì •","author":"jayoon"}},"previous":{"fields":{"slug":"/nextjs-reactquery-useinfinitequery/"},"frontmatter":{"title":"Next.js ì „í™˜ ê³¼ì • - Infinite scroll ë°ì´í„°ì— react query ì ìš©í•˜ê¸°"}},"next":{"fields":{"slug":"/nextjs-refresh-token/"},"frontmatter":{"title":"Next.js ì „í™˜ ê³¼ì • - ìë™ë¡œê·¸ì¸ (í† í° ê°±ì‹ )"}}},"pageContext":{"id":"747b18b7-ff8b-5239-a05a-3ed52dbf0e82","previousPostId":"553ca892-f753-50be-8a67-0948af59f705","nextPostId":"fce8c886-0c77-5b29-bc6d-08bb3c08f0f1"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}
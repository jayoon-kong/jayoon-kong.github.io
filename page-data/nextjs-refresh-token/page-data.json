{"componentChunkName":"component---src-templates-blog-post-js","path":"/nextjs-refresh-token/","result":{"data":{"site":{"siteMetadata":{"title":"ê³µììœ¤ì˜ ê¸°ìˆ ë¸”ë¡œê·¸"}},"markdownRemark":{"id":"fce8c886-0c77-5b29-bc6d-08bb3c08f0f1","excerpt":"V ì»¬ëŸ¬ë§ì—ì„œëŠ” jwt ì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nìµœì´ˆì— ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì„ í•˜ë©´ ì„œë²„ë¡œë¶€í„° ê³¼ ì„ ë°œê¸‰ë°›ê³ , ê·¸ ê°’ì„ ì–´ë”˜ê°€ì— ì €ì¥í•´ ë‘ê³  ìˆë‹¤ê°€ í† í° ê°’ì´ ë§Œë£Œë˜ë©´ ì €ì¥ëœ ì„ ì´ìš©í•´ ë‹¤ì‹œ ìœ íš¨í•œ í† í°ì„ ë°œê¸‰ë°›ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ê¸°ì¡´ì˜ V ì»¬ëŸ¬ë§ì€ SPAâ€¦","html":"<p>V ì»¬ëŸ¬ë§ì—ì„œëŠ” jwt ì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nìµœì´ˆì— ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì„ í•˜ë©´ ì„œë²„ë¡œë¶€í„° <code class=\"language-text\">access_token</code>ê³¼ <code class=\"language-text\">refresh_token</code>ì„ ë°œê¸‰ë°›ê³ , ê·¸ ê°’ì„ ì–´ë”˜ê°€ì— ì €ì¥í•´ ë‘ê³  ìˆë‹¤ê°€ í† í° ê°’ì´ ë§Œë£Œë˜ë©´ ì €ì¥ëœ <code class=\"language-text\">refresh_token</code>ì„ ì´ìš©í•´ ë‹¤ì‹œ ìœ íš¨í•œ í† í°ì„ ë°œê¸‰ë°›ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.</p>\n<p>ê¸°ì¡´ì˜ V ì»¬ëŸ¬ë§ì€ SPAì´ê¸° ë•Œë¬¸ì— ì´ˆê¸° í˜ì´ì§€ ì§„ì… ì‹œ í† í° ë§Œë£Œ ì—¬ë¶€ë¥¼ í•œ ë²ˆ ì²´í¬í•˜ì—¬ ìë™ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê²½ìš° í† í° ê°±ì‹  ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³ , ì´í›„ì—ëŠ” API fech ë•Œë§ˆë‹¤ ë§Œë£Œ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ì—¬ í† í°ì„ ê°±ì‹ í•©ë‹ˆë‹¤.\nì´ë²ˆì—ë„ ë¹„ìŠ·í•˜ê²Œ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œ axios instanceì˜ ìš”ì²­ ì¸í„°ì…‰í„°ì—ì„œ ë§Œë£Œ ì²´í¬ ë° ìë™ë¡œê·¸ì¸ì„ ìˆ˜í–‰í•˜ë„ë¡ í•˜ì˜€ëŠ”ë°, í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ API ìš”ì²­ ì‹œ í† í°ì´ ë§Œë£Œë˜ì—ˆì„ ê²½ìš°ì—ëŠ” ì„±ê³µì ìœ¼ë¡œ ìë™ë¡œê·¸ì¸ì´ ë˜ì—ˆì§€ë§Œ ì„œë²„ ì‚¬ì´ë“œì—ì„œ ìµœì´ˆë¡œ ìš”ì²­í–ˆì„ ê²½ìš°ì—ëŠ” ê°±ì‹ ì´ ì œëŒ€ë¡œ ì²˜ë¦¬ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>\n<h3>ì´ìŠˆ1</h3>\n<p>ì²˜ìŒì— ì‘ì„±í•œ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// axios instance</span>\ninstance<span class=\"token punctuation\">.</span>interceptors<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">async</span> <span class=\"token parameter\">config</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ìš”ì²­ ë°ì´í„° ì²˜ë¦¬</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>TokenHelper<span class=\"token punctuation\">.</span><span class=\"token function\">needRefresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">updateToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> access_token<span class=\"token punctuation\">,</span> refresh_token<span class=\"token punctuation\">,</span> expires_in <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> response\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>access_token<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        TokenHelper<span class=\"token punctuation\">.</span><span class=\"token function\">setToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">token</span><span class=\"token operator\">:</span> access_token<span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">refreshToken</span><span class=\"token operator\">:</span> refresh_token<span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">expired</span><span class=\"token operator\">:</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> expires_in<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">merge</span><span class=\"token punctuation\">(</span><span class=\"token function\">getConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ìš”ì²­ ì˜¤ë¥˜ ì²˜ë¦¬</span>\n    <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// update token</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">updateToken</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token operator\">...</span>\n  <span class=\"token keyword\">return</span> axios\n    <span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span>\n      <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>baseURI<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/oauth/token</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">grant_type</span><span class=\"token operator\">:</span> <span class=\"token string\">'refresh_token'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">refresh_token</span><span class=\"token operator\">:</span> refreshToken<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">scope</span><span class=\"token operator\">:</span> <span class=\"token string\">'read'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/x-www-form-urlencoded'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">Authorization</span><span class=\"token operator\">:</span> <span class=\"token function\">getAuthorization</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> Record<span class=\"token operator\">&lt;</span>string<span class=\"token punctuation\">,</span> string<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ì›ì¸ì„ ì‚´í´ ë³´ë‹ˆ ìš°ì„  í—¤ë”ê°€ ì œëŒ€ë¡œ ìš”ì²­ë˜ì§€ ì•Šê³  ìˆì—ˆìŠµë‹ˆë‹¤.\nëª¨ë“  APIëŠ” ìš”ì²­ ì‹œ axiosì˜ interceptorsë¥¼ ê±°ì³ <code class=\"language-text\">getConfig()</code>ì—ì„œ ì„ ì–¸ëœ ê³µí†µ í—¤ë”ì™€ ê° APIì—ì„œ ì „ë‹¬ëœ íŠ¹ì • configê°€ í•©ì³ì§„ í—¤ë”ë¥¼ ìµœì¢…ì ìœ¼ë¡œ ì „ë‹¬í•˜ê²Œ ë˜ëŠ”ë°, <code class=\"language-text\">updateToken</code> í•¨ìˆ˜ì—ì„œëŠ” axios instanceë¥¼ ìƒì†ë°›ì§€ ì•Šê³  ì§ì ‘ axiosë¥¼ í˜¸ì¶œí•´ì„œ í—¤ë”ê°€ ì œëŒ€ë¡œ ë„˜ì–´ê°€ì§€ ì•ŠëŠ” ë¬¸ì œì˜€ìŠµë‹ˆë‹¤.</p>\n<p>ê·¸ë˜ì„œ <code class=\"language-text\">updateToken()</code> ì‹œ ë‹¤ìŒê³¼ ê°™ì´ í—¤ë”ë¥¼ ì„¸íŒ…í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span><span class=\"token function\">getConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/x-www-form-urlencoded'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">Authorization</span><span class=\"token operator\">:</span> <span class=\"token function\">getAuthorization</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> Record<span class=\"token operator\">&lt;</span>string<span class=\"token punctuation\">,</span> string<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ì´ë ‡ê²Œ í–ˆë”ë‹ˆ í† í° ê°±ì‹  APIì—ì„œ ì •ìƒ ì‘ë‹µì„ ë°›ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>\n<h3>ì´ìŠˆ2</h3>\n<p>í† í°ì€ ì •ìƒì ìœ¼ë¡œ ê°€ì ¸ì™”ìœ¼ë‚˜ ì›ë˜ í˜¸ì¶œí•˜ë ¤ë˜ APIì—ì„œ 401 ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤. ìš”ì²­ í—¤ë”ë¥¼ ì‚´í´ë³´ë‹ˆ ê°±ì‹ ëœ í† í° ê°’ì´ ì œëŒ€ë¡œ ì „ë‹¬ë˜ì§€ ì•Šê³  ìˆì—ˆìŠµë‹ˆë‹¤.</p>\n<p>ì½”ë“œë¥¼ ë‹¤ì‹œ ì‚´í´ë³´ë‹ˆ, í† í°ì„ ì„¸íŒ…í•œ í›„ ë³€ê²½ëœ í† í° ì •ë³´ë¥¼ í—¤ë”ì— ì‹¤ì–´ ì£¼ëŠ” ì‘ì—…ì´ ëˆ„ë½ë˜ì—ˆë‹¤ëŠ” ì ì„ ë°œê²¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\nê°±ì‹ ëœ í† í° ê°’ì„ ì¿ í‚¤ì—ë§Œ ì €ì¥í•˜ê³  ì •ì‘ í—¤ë” ì •ë³´ëŠ” ì—…ë°ì´íŠ¸í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì—, ì„œë²„ë¡œ ìš”ì²­ë˜ëŠ” í—¤ë”ì—ëŠ” ê¸°ì¡´ì— ë„˜ì–´ì˜¨ config ê°’ì— ë“¤ì–´ìˆëŠ” <code class=\"language-text\">Authorization</code> ì •ë³´ê°€ ë“¤ì–´ê°€ê²Œ ë˜ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.</p>\n<p>ê·¸ë˜ì„œ ë‹¤ìŒê³¼ ê°™ì´ í—¤ë”ì— ìƒˆ í† í°ì„ ì‹¤ì–´ì„œ returní•˜ë„ë¡ ë³€ê²½í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> mergeConfig <span class=\"token operator\">=</span> <span class=\"token function\">merge</span><span class=\"token punctuation\">(</span><span class=\"token function\">getConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>TokenHelper<span class=\"token punctuation\">.</span><span class=\"token function\">needRefresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">updateToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> access_token<span class=\"token punctuation\">,</span> refresh_token<span class=\"token punctuation\">,</span> expires_in <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> response\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>access_token<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    TokenHelper<span class=\"token punctuation\">.</span><span class=\"token function\">setToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">token</span><span class=\"token operator\">:</span> access_token<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">refreshToken</span><span class=\"token operator\">:</span> refresh_token<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">expired</span><span class=\"token operator\">:</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> expires_in<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>mergeConfig<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">Authorization</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Bearer </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>access_token<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">return</span> mergeConfig</code></pre></div>\n<h3>ì´ìŠˆ3</h3>\n<p>í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í–ˆì„ ë•ŒëŠ” ìœ„ì™€ ê°™ì´ í–ˆì„ ë•Œ ì˜ ìˆ˜í–‰ë˜ì—ˆëŠ”ë°, ì„œë²„ ì‚¬ì´ë“œì—ì„œëŠ” ê³„ì†í•´ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.\nì›ì¸ì„ ë¶„ì„í•´ ë³´ë‹ˆ, <strong>ì„œë²„ ì‚¬ì´ë“œì—ì„œëŠ” ê°±ì‹ ëœ í† í° ê°’ì„ ê°€ì ¸ì™€ë„ ë¸Œë¼ìš°ì €ì˜ ì¿ í‚¤ì— ì§ì ‘ì ìœ¼ë¡œ ì„¸íŒ…ì„ í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸</strong>ì´ì—ˆìŠµë‹ˆë‹¤.\nì•„ë¬´ë¦¬ setTokenì„ í•´ë„ ì„œë²„ì—ì„œëŠ” ë¸Œë¼ìš°ì €ì— ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í–ˆê¸° ë•Œë¬¸ì— ê°±ì‹ ëœ í† í° ê°’ì´ ì‹¤ì œë¡œ ë°˜ì˜ë˜ì§€ ì•Šì•˜ê³ , ì´í›„ í˜¸ì¶œë˜ëŠ” APIì—ì„œëŠ” ê·¸ëŒ€ë¡œ ì¿ í‚¤ì˜ í† í° ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ í—¤ë”ì— ì‹¤ì–´ ë³´ëƒˆê¸° ë•Œë¬¸ì— ê³„ì† 401 ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ë˜ ê²ƒì…ë‹ˆë‹¤.</p>\n<p>ì–´ë–¤ ë°©ë²•ì´ ìˆì„ê¹Œ ê²€ìƒ‰í•˜ë‹¤ê°€, í˜ì´ì§€ì˜ ì‘ë‹µì— ì¿ í‚¤ë¥¼ ë‹¤ì‹œ ì„¸íŒ…í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë‹¤ì‹œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>\n<p><em>íë¦„ì„ ì‰½ê²Œ ì •ë¦¬í•˜ìë©´,Â <strong>í˜ì´ì§€ ìš”ì²­ì— ë‹´ê¸´ ì¿ í‚¤ë¥¼ ë¹¼ì™€</strong>ì„œ refresh apië¥¼ í˜¸ì¶œí•˜ëŠ”ë° ì‚¬ìš©í•˜ê³ , ê·¸ ìƒˆë¡œ ë°›ì•„ì˜¨ í† í°ë“¤ì„Â <strong>í˜ì´ì§€ ì‘ë‹µì˜ í—¤ë”ì— ë‹¤ì‹œ ê»´ì„œ ë¸Œë¼ìš°ì €ë¡œ</strong> ë³´ë‚´ì£¼ëŠ” ê²ƒì´ë‹¤.</em></p>\n<p>ì¶œì²˜ : <a href=\"https://9yujin.tistory.com/104\">https://9yujin.tistory.com/104</a></p>\n<p><code class=\"language-text\">_app.tsx</code> ì§„ì… ì‹œ initializeë¥¼ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ì—ì„œ í† í° ê°’ì„ ê°±ì‹ í•˜ê³ , ë°›ì•„ì˜¨ í† í° ê°’ì„ ì‘ë‹µ í—¤ë”ì— ì„¸íŒ…í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// _app.tsx</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setToken</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">token</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> refreshToken<span class=\"token operator\">?</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> expired<span class=\"token operator\">?</span><span class=\"token operator\">:</span> number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  RequestHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setServerToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n  RequestHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setServerRefreshToken</span><span class=\"token punctuation\">(</span>refreshToken<span class=\"token punctuation\">)</span>\n  RequestHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setServerExpired</span><span class=\"token punctuation\">(</span>expired<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getNewToken</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\"><span class=\"token literal-property property\">res</span><span class=\"token operator\">:</span> any<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">token</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span>\n  refreshToken<span class=\"token operator\">?</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span>\n  expired<span class=\"token operator\">?</span><span class=\"token operator\">:</span> number</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> time <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Set-Cookie\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">token=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>token<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">; path=/; expires=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>time<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">refreshToken=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>refreshToken<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">; path=/; expires=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>time<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">expired=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>expired<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">; path=/; expires=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>time<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">}</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">setToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">,</span> refreshToken<span class=\"token punctuation\">,</span> expired<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    token<span class=\"token punctuation\">,</span>\n    refreshToken<span class=\"token punctuation\">,</span>\n    expired<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">initialize</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">ctx</span><span class=\"token operator\">:</span> any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">req</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> cookies<span class=\"token punctuation\">,</span> headers<span class=\"token punctuation\">,</span> query <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    res<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> ctx\n\n  <span class=\"token function\">setToken</span><span class=\"token punctuation\">(</span>cookies<span class=\"token operator\">?.</span>token<span class=\"token punctuation\">,</span> cookies<span class=\"token operator\">?.</span>refreshToken<span class=\"token punctuation\">,</span> cookies<span class=\"token operator\">?.</span>expired<span class=\"token punctuation\">)</span>\n  RequestHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setServerAgent</span><span class=\"token punctuation\">(</span>headers <span class=\"token operator\">?</span> headers<span class=\"token punctuation\">[</span><span class=\"token string\">\"user-agent\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>TokenHelper<span class=\"token punctuation\">.</span><span class=\"token function\">needRefresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">updateToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> access_token<span class=\"token punctuation\">,</span> refresh_token<span class=\"token punctuation\">,</span> expires_in <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> response\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>access_token<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">getNewToken</span><span class=\"token punctuation\">(</span>\n        res<span class=\"token punctuation\">,</span>\n        access_token<span class=\"token punctuation\">,</span>\n        refresh_token<span class=\"token punctuation\">,</span>\n        Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> expires_in\n      <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ì´ë ‡ê²Œ í•˜ë©´ ìƒˆë¡œìš´ í† í° ê°’ì´ ë¸Œë¼ìš°ì €ì˜ ì¿ í‚¤ì— ì„¸íŒ…ë˜ì–´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>\n<p>ì´ì œ ì„œë²„ì‚¬ì´ë“œì™€ í´ë¼ì´ì–¸íŠ¸ì‚¬ì´ë“œ ëª¨ë“  API í˜¸ì¶œ ì‹œ ìë™ë¡œê·¸ì¸ì´ ì˜ ë™ì‘í•©ë‹ˆë‹¤. ğŸ™‚</p>","frontmatter":{"title":"Next.js ì „í™˜ ê³¼ì • (5) - ìë™ë¡œê·¸ì¸ (í† í° ê°±ì‹ )","date":"April 04, 2023","description":"Reactë¡œ êµ¬í˜„ëœ SPA (CSR) í”„ë¡œì íŠ¸ë¥¼ Next.jsë¡œ ì „í™˜í•˜ëŠ” ê³¼ì •","author":"jayoon"}},"previous":{"fields":{"slug":"/nextjs-cookie-useragent/"},"frontmatter":{"title":"Next.js ì „í™˜ ê³¼ì • (4) - ì¿ í‚¤ ë° UserAgent ì²˜ë¦¬í•˜ê¸°"}},"next":{"fields":{"slug":"/nextjs-reactquery-useinfinitequery/"},"frontmatter":{"title":"Next.js ì „í™˜ ê³¼ì • (6) - Infinite scroll ë°ì´í„°ì— react query ì ìš©í•˜ê¸°"}}},"pageContext":{"id":"fce8c886-0c77-5b29-bc6d-08bb3c08f0f1","previousPostId":"06e9508b-623f-542a-bb40-1caa2b55655d","nextPostId":"553ca892-f753-50be-8a67-0948af59f705"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}